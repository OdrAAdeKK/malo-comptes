{% extends 'base.html' %}

{% block title %}Déclaration d’un cachet{% endblock %}

{% block content %}
<style>
    .form-section {
        max-width: 700px;
        margin: auto;
        padding: 30px;
        background-color: #f8f8f8;
        border-radius: 12px;
        box-shadow: 0 0 10px rgba(0,0,0,0.1);
    }

    label {
        font-weight: bold;
        margin-top: 15px;
        display: block;
    }

    input, select {
        width: 100%;
        padding: 10px;
        margin-top: 5px;
        margin-bottom: 20px;
        border-radius: 6px;
        border: 1px solid #ccc;
    }


</style>

<div class="form-section">
    <h1>Déclaration d’un cachet</h1>
  <form method="POST" autocomplete="off">

    <!-- Ligne 1 : Musicien + Dates -->
<div class="form-row-flex" style="position: relative; display: flex;">
  <!-- MUSICIEN -->
  <div style="flex: 1; min-width: 80px;">
    <label for="musicien">Musicien</label>
    <select name="musicien" id="musicien" required style="width: 60%;">
      <option value="">-- Sélectionner --</option>
      {% for m in musiciens if m.nom != 'ASSO7' and m.nom != 'CB ASSO7' %}
        <option value="{{ m.id }}">{{ m.prenom }} {{ m.nom }}</option>
      {% endfor %}
    </select>
  </div>

  <!-- DATES en position absolue à droite -->
  <div style="position: absolute; top: 0; right: 0; width: 30%;">
    <label for="dates">Date</label>
    <input type="text" id="flatpickr_trigger" style="opacity:0; position:absolute; z-index:-1;">
    <textarea id="dates_display" readonly
              style="height: 180px; width: 70%; resize: none; white-space: pre-wrap; background-color: #fefefe; border: 1px solid #ccc; padding: 8px;"></textarea>
    <input type="hidden" name="dates_hidden" id="dates_hidden" required>
  </div>
</div>

    <!-- Ligne 2 : Montant + Nombre de cachets -->
    <div class="form-row-flex" style="display: flex; gap: 10px; flex-wrap: wrap; margin-top: 20px;">
      <!-- MONTANT -->
      <div style="flex: 1 1 40px; min-width: 120px;">
        <label for="montant">Montant (€)</label>
        <input type="number" step="0.01" name="montant" id="montant" required style="max-width: 100px;">
      </div>

      <!-- NOMBRE DE CACHETS -->
      <div style="flex: 1 1 140px; min-width: 120px;">
        <label for="nombre_cachets">Nombre de cachets</label>
        <input type="number" name="nombre_cachets" id="nombre_cachets" readonly 
               style="background: #f0f0f0; font-weight: bold; max-width: 100px;">
      </div>
    </div>

    <!-- Ligne 3 : Montant total -->
    <div style="margin-top: 20px;">
      <label for="montant_total">Montant total (€)</label>
      <input type="text" id="montant_total" disabled style="background: #f9f9f9; font-weight: bold;">
    </div>

<!-- BOUTONS ligne 1 -->
		        <div class="button-row">
				   <button type="submit" class="valider-button" style="width: 100%; max-width: 700px;">Valider</button>
				</div>
				<div class="button-row">
					<a href="{{ url_for('accueil') }}" class="back-button">Accueil</a>
					<a href="#" onclick="if (document.referrer) { window.history.back(); } else { window.location.href='{{ url_for('accueil') }}'; }" class="retour-button">⬅ Retour</a>
					<a href="{{ url_for('archives_cachets') }}" class="archives-button">Archives</a>
					<a href="{{ url_for('cachets_a_venir') }}" class="a-venir-button">À venir</a>  <!-- ⬅ Nouveau bouton -->
				</div>


{% with messages = get_flashed_messages(with_categories=true) %}
  {% if messages %}
    <div class="messages">
      {% for category, message in messages %}
        <div class="alert alert-{{ category }}">{{ message }}</div>
      {% endfor %}
    </div>
  {% endif %}
{% endwith %}

  </form>


	<!-- FLATPICKR -->
	<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/flatpickr/dist/flatpickr.min.css">
	<script src="https://cdn.jsdelivr.net/npm/flatpickr"></script>
	<script src="https://cdn.jsdelivr.net/npm/flatpickr/dist/l10n/fr.js"></script>
	
<script src="{{ url_for('static', filename='js/cachets_flatpickr.js') }}"></script>


{% endblock %}
